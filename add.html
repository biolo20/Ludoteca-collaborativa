<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aggiungi un nuovo gioco ‚Äì Ludoteca collaborativa</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 24px auto; padding: 0 16px; }
    label { display:block; margin: 12px 0 6px; font-weight:600; }
    input, textarea, select, button { width:100%; padding:10px; font-size:16px; }
    button { margin-top:14px; cursor:pointer; }
    nav a { margin-right:12px; }
  </style>
</head>
<body>
  <nav>
    <a href="./index.html">‚Üê Home</a>
    <a href="./catalogo.html">Catalogo</a>
  </nav>

  <h1>‚ûï Aggiungi un nuovo gioco</h1>

  <form id="game-form">
    <!-- honeypot antispam -->
    <input name="honeypot" style="display:none">

    <label>Nome del gioco</label>
    <input name="nome" required>

    <label>Categoria</label>
    <input name="categoria" required placeholder="es. Staffette, Giochi con la palla">

    <label>Et√† minima</label>
    <input name="eta" type="number" required>

    <label>Numero di giocatori</label>
    <input name="giocatori" required placeholder="es. 2-6">

    <label>Durata (minuti)</label>
    <input name="durata" type="number" required>

    <label>Materiale necessario</label>
    <input name="materiale" required>

    <label>Descrizione breve</label>
    <textarea name="descrizione" required></textarea>

    <label>Istruzioni sintetiche</label>
    <textarea name="istruzioni" required></textarea>

    <label>Note di sicurezza (opzionale)</label>
    <input name="sicurezza">

    <label>Tag (separati da virgola, opzionale)</label>
    <input name="tag" placeholder="es. cooperativo, legno">

    <button type="submit">Invia proposta</button>
  </form>

  <script>
  document.getElementById("game-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const f = e.target;
    const d = new FormData(f);
    const data = {
      nome: d.get("nome"),
      categoria: d.get("categoria"),
      eta: d.get("eta"),
      giocatori: d.get("giocatori"),
      materiale: d.get("materiale"),
      durata: d.get("durata"),
      descrizione: d.get("descrizione"),
      istruzioni: d.get("istruzioni"),
      sicurezza: d.get("sicurezza") || "",
      tag: d.get("tag") || "",
      honeypot: d.get("honeypot") || ""
    };

    const btn = f.querySelector("button[type=submit]");
    const old = btn.textContent;
    btn.disabled = true; btn.textContent = "Invio‚Ä¶";

    try {
      const res = await fetch("https://ludoteca-worker.biololeonardo.workers.dev", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if (!res.ok) throw new Error(json.message || "Errore");

      alert("üéâ Proposta inviata! Vedi Pull Request: " + json.pr_url);
      f.reset();
    } catch (err) {
      alert("‚ö†Ô∏è Ops: " + err.message);
    } finally {
      btn.disabled = false; btn.textContent = old;
    }
  });
  </script>
  <script>
document.getElementById("game-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const f = e.target;
  const d = new FormData(f);
  const data = {
    nome: d.get("nome"),
    categoria: d.get("categoria"),
    eta: d.get("eta"),
    giocatori: d.get("giocatori"),
    materiale: d.get("materiale"),
    durata: d.get("durata"),
    descrizione: d.get("descrizione"),
    istruzioni: d.get("istruzioni"),
    sicurezza: d.get("sicurezza") || "",
    tag: d.get("tag") || "",
    honeypot: d.get("honeypot") || ""
  };

  const btn = f.querySelector("button[type=submit]");
  const old = btn.textContent;
  btn.disabled = true; btn.textContent = "Invio‚Ä¶";

  try {
    const res = await fetch("https://ludoteca-worker.biololeonardo.workers.dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!res.ok) throw new Error(json.message || "Errore");

    alert("üéâ Proposta inviata! Vedi Pull Request: " + json.pr_url);
    f.reset();
  } catch (err) {
    alert("‚ö†Ô∏è Ops: " + err.message);
  } finally {
    btn.disabled = false; btn.textContent = old;
  }
});
</script>
</body>
</html>
